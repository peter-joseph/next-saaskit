import{i as Y,a as j,d as D,r as H,$ as J}from"./index-BhyzFoYa.js";import{$ as Q,a as Z}from"./useHighlightSelectionDescription-mvodKLgW.js";import{$ as _}from"./useHasTabbableChild-Dqun3FsI.js";import{$ as ee}from"./useSelectableList-Df_lTvxt.js";import{I as oe,l as w,s as re}from"./useFocusRing-D9TQlOey.js";import{$}from"./getScrollParent-BVEz9nhD.js";import{c as y}from"./scrollIntoView-BiVEfWHi.js";import{b as F}from"./FocusScope-CgNthz1u.js";import{b}from"./useFocusable-DQgo1lwm.js";import{r as ie}from"./iframe-D6Fs4So_.js";import{k as ne}from"./SelectionManager-Ildo9Xoe.js";import{$ as te}from"./context-TYPMPinS.js";const N=new WeakMap;function O(n,e){var i;let{id:c}=(i=N.get(n))!==null&&i!==void 0?i:{};if(!c)throw new Error("Unknown list");return`${c}-${le(e)}`}function le(n){return typeof n=="string"?n.replace(/\s*/g,""):""+n}function me(n,e,i){let{isVirtualized:c,keyboardDelegate:g,layoutDelegate:o,onAction:v,disallowTypeAhead:d,linkBehavior:s="action",keyboardNavigationBehavior:P="arrow",escapeKeyBehavior:m="clearSelection",shouldSelectOnPressUp:K}=n;!n["aria-label"]&&!n["aria-labelledby"]&&console.warn("An aria-label or aria-labelledby prop is required for accessibility.");let{listProps:h}=ee({selectionManager:e.selectionManager,collection:e.collection,disabledKeys:e.disabledKeys,ref:i,keyboardDelegate:g,layoutDelegate:o,isVirtualized:c,selectOnFocus:e.selectionManager.selectionBehavior==="replace",shouldFocusWrap:n.shouldFocusWrap,linkBehavior:s,disallowTypeAhead:d,autoFocus:n.autoFocus,escapeKeyBehavior:m}),f=Y(n.id);N.set(e,{id:f,onAction:v,linkBehavior:s,keyboardNavigationBehavior:P,shouldSelectOnPressUp:K});let A=Q({selectionManager:e.selectionManager,hasItemActions:!!v}),x=_(i,{isDisabled:e.collection.size!==0}),u=j(n,{labelable:!0}),k=D(u,{role:"grid",id:f,"aria-multiselectable":e.selectionManager.selectionMode==="multiple"?"true":void 0},e.collection.size===0?{tabIndex:x?-1:0}:h,A);return c&&(k["aria-rowcount"]=e.collection.size,k["aria-colcount"]=1),Z({},e),{gridProps:k}}const U={expand:{ltr:"ArrowRight",rtl:"ArrowLeft"},collapse:{ltr:"ArrowLeft",rtl:"ArrowRight"}};function he(n,e,i){var c,g;let{node:o,isVirtualized:v}=n,{direction:d}=te(),{onAction:s,linkBehavior:P,keyboardNavigationBehavior:m,shouldSelectOnPressUp:K}=N.get(e),h=H(),f=ie.useRef(null),A=()=>{i.current!==null&&(f.current!=null&&o.key!==f.current||!w(i.current,document.activeElement))&&b(i.current)},x={},u=n.hasChildItems,k=e.selectionManager.isLink(o.key);if(o!=null&&"expandedKeys"in e){var E,B;let r=(E=(B=e.collection).getChildren)===null||E===void 0?void 0:E.call(B,o.key);u=u||[...r??[]].length>1,s==null&&!k&&e.selectionManager.selectionMode==="none"&&u&&(s=()=>e.toggleKey(o.key));let t=u?e.expandedKeys.has(o.key):void 0,a=1;if(o.level>0&&o?.parentKey!=null){let l=e.collection.getItem(o.parentKey);if(l){var M,S;a=[...(M=(S=e.collection).getChildren)===null||M===void 0?void 0:M.call(S,l.key)].filter(X=>X.type==="item").length}}else a=[...e.collection].filter(l=>l.level===0&&l.type==="item").length;x={"aria-expanded":t,"aria-level":o.level+1,"aria-posinset":o?.index+1,"aria-setsize":a}}let{itemProps:T,...z}=ne({selectionManager:e.selectionManager,key:o.key,ref:i,isVirtualized:v,shouldSelectOnPressUp:n.shouldSelectOnPressUp||K,onAction:s||!((c=o.props)===null||c===void 0)&&c.onAction?J((g=o.props)===null||g===void 0?void 0:g.onAction,s?()=>s(o.key):void 0):void 0,focus:A,linkBehavior:P}),C=r=>{if(!w(r.currentTarget,r.target)||!i.current||!document.activeElement)return;let t=F(i.current);if(t.currentNode=document.activeElement,"expandedKeys"in e&&document.activeElement===i.current){if(r.key===U.expand[d]&&e.selectionManager.focusedKey===o.key&&u&&!e.expandedKeys.has(o.key)){e.toggleKey(o.key),r.stopPropagation();return}else if(r.key===U.collapse[d]&&e.selectionManager.focusedKey===o.key&&u&&e.expandedKeys.has(o.key)){e.toggleKey(o.key),r.stopPropagation();return}}switch(r.key){case"ArrowLeft":if(m==="arrow"){let l=d==="rtl"?t.nextNode():t.previousNode();if(l)r.preventDefault(),r.stopPropagation(),b(l),y(l,{containingElement:$(i.current)});else if(r.preventDefault(),r.stopPropagation(),d==="rtl")b(i.current),y(i.current,{containingElement:$(i.current)});else{t.currentNode=i.current;let p=V(t);p&&(b(p),y(p,{containingElement:$(i.current)}))}}break;case"ArrowRight":if(m==="arrow"){let l=d==="rtl"?t.previousNode():t.nextNode();if(l)r.preventDefault(),r.stopPropagation(),b(l),y(l,{containingElement:$(i.current)});else if(r.preventDefault(),r.stopPropagation(),d==="ltr")b(i.current),y(i.current,{containingElement:$(i.current)});else{t.currentNode=i.current;let p=V(t);p&&(b(p),y(p,{containingElement:$(i.current)}))}}break;case"ArrowUp":case"ArrowDown":if(!r.altKey&&w(i.current,r.target)){var a;r.stopPropagation(),r.preventDefault(),(a=i.current.parentElement)===null||a===void 0||a.dispatchEvent(new KeyboardEvent(r.nativeEvent.type,r.nativeEvent))}break}},L=r=>{if(f.current=o.key,r.target!==i.current){re()||e.selectionManager.setFocusedKey(o.key);return}},R=r=>{if(!(!w(r.currentTarget,r.target)||!i.current||!document.activeElement))switch(r.key){case"Tab":if(m==="tab"){let t=F(i.current,{tabbable:!0});t.currentNode=document.activeElement,(r.shiftKey?t.previousNode():t.nextNode())&&r.stopPropagation()}}},W=oe(o.props),q=z.hasAction?W:{},I=D(T,q,{role:"row",onKeyDownCapture:C,onKeyDown:R,onFocus:L,"aria-label":o["aria-label"]||o.textValue||void 0,"aria-selected":e.selectionManager.canSelectItem(o.key)?e.selectionManager.isSelected(o.key):void 0,"aria-disabled":e.selectionManager.isDisabled(o.key)||void 0,"aria-labelledby":h&&(o["aria-label"]||o.textValue)?`${O(e,o.key)} ${h}`:void 0,id:O(e,o.key)});if(v){let{collection:r}=e,t=[...r];I["aria-rowindex"]=t.find(a=>a.type==="section")?[...r.getKeys()].filter(a=>{var l;return((l=r.getItem(a))===null||l===void 0?void 0:l.type)!=="section"}).findIndex(a=>a===o.key)+1:o.index+1}let G={role:"gridcell","aria-colindex":1};return{rowProps:{...D(I,x)},gridCellProps:G,descriptionProps:{id:h},...z}}function V(n){let e=null,i=null;do i=n.lastChild(),i&&(e=i);while(i);return e}export{he as $,me as a,O as b};
